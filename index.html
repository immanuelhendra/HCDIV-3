<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HDB Resale Price Yearly Line Race</title>
    <style>
        #main {
            width: 100%;
            height: 600px;
        }
    </style>
    <script type="module">
        import { Line } from 'https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.esm.min.js';

        // Load and process CSV data
        async function fetchDataFromCSV(url) {
            const response = await fetch(url);
            const data = await response.text();
            const rows = data.trim().split('\n').map(row => row.split(','));

            // Extract headers for each year
            const headers = rows[0].slice(1);  // Skip the first column (town name)
            const areasData = {};

            rows.slice(1).forEach(row => {
                const area = row[0].trim(); // Column A: area name
                areasData[area] = headers.map((year, index) => ({
                    year: year,
                    resalePrice: parseFloat(row[index + 1]) || 0
                }));
            });
            return { headers, areasData };
        }

        function createChart(data, areas, years) {
            const ctx = document.getElementById('main').getContext('2d');

            // Define datasets for each area
            const datasets = areas.map((area, i) => ({
                label: area,
                data: data[area].map(item => ({ x: item.year, y: item.resalePrice })),
                borderColor: `hsl(${(i * 360) / areas.length}, 70%, 50%)`,
                fill: false,
                tension: 0.4
            }));

            // Create chart
            new Line(ctx, {
                data: {
                    datasets: datasets,
                },
                options: {
                    animation: {
                        duration: 10000,  // 10 seconds for race animation
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Year'
                            },
                            min: Math.min(...years),
                            max: Math.max(...years)
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Resale Price (SGD)'
                            },
                            ticks: {
                                stepSize: 10 // Change based on scale needed
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: context => `${context.dataset.label}: SGD ${context.raw.y}`
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        async function initChart() {
            const { headers: years, areasData } = await fetchDataFromCSV('HDB Resale Price since 2017.csv');
            const areas = Object.keys(areasData);
            createChart(areasData, areas, years);
        }

        window.onload = initChart;
    </script>
</head>
<body>
    <h1>HDB Resale Prices by Area (2017-2024)</h1>
    <p>This chart shows the yearly trend in HDB resale prices across different areas in Singapore from 2017 onward.</p>
    <canvas id="main"></canvas>
</body>
</html>
